4354340dce41b8d36d2f376618eedbfa

AIzaSyCLA5ip_tje63VQuHbbRQWrotcXtlIxXn4

AIzaSyA7PieaEbrY3XQZ_8brI-vb3gyILkr_WLw

AIzaSyClQt8OfRZHggy2ZYSocxwiW9E8Lvrxf_8


<!DOCTYPE html> 
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Weather + Chat App</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
<style>
  :root{
    --bg1:#74b9ff;
    --bg2:#0984e3;
    --card-bg: rgba(255,255,255,0.14);
    --muted: rgba(255,255,255,0.85);
    --accent:#00b894;
    --glass-border: rgba(255,255,255,0.12);
    --shadow: 0 8px 30px rgba(2,6,23,0.25);
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    min-height:100vh;
    font-family:'Inter',system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;
    background: radial-gradient(ellipse at 10% 10%, rgba(255,255,255,0.04), transparent 10%),
                linear-gradient(180deg,var(--bg1),var(--bg2));
    color:var(--muted);
    display:flex;
    align-items:center;
    justify-content:center;
    padding:28px;
  }

  /* Layout container */
  .app {
    width:100%;
    max-width:980px;
    display:grid;
    grid-template-columns: 1fr 420px;
    gap:20px;
    align-items:start;
  }

  /* On small screens: single column */
  @media (max-width:900px){
    .app{ grid-template-columns: 1fr; padding:8px; }
  }

  /* LEFT main pane (weather) */
  .panel {
    background: var(--card-bg);
    border-radius:16px;
    padding:18px;
    box-shadow:var(--shadow);
    backdrop-filter: blur(10px) saturate(120%);
    border:1px solid var(--glass-border);
  }

  .panel h1{
    margin:0 0 12px 0;
    font-size:20px;
    font-weight:700;
    color:white;
    display:flex;
    align-items:center;
    gap:10px;
  }

  /* search row */
  .search-row{
    display:flex;
    gap:10px;
    margin-bottom:12px;
  }
  .search-row input{
    flex:1;
    padding:10px 12px;
    border-radius:10px 0 0 10px;
    border: none;
    outline:none;
    font-size:15px;
  }
  .search-row button{
    padding:10px 14px;
    border-radius:0 10px 10px 0;
    border:none;
    cursor:pointer;
    font-weight:600;
    background:#2d3436;
    color:white;
  }

  .small-row{
    display:flex;
    gap:8px;
    margin-bottom:14px;
    align-items:center;
    flex-wrap:wrap;
  }

  .btn-loc{
    background:var(--accent);
    color:#063;
    border:none;
    padding:8px 12px;
    border-radius:10px;
    cursor:pointer;
    font-weight:600;
  }

  .btn-chat{
    margin-left:auto;
    background:transparent;
    border:1px solid rgba(255,255,255,0.12);
    color:rgb(138, 138, 204);
    padding:8px 12px;
    border-radius:10px;
    cursor:pointer;
    display:flex;
    gap:8px;
    align-items:center;
  }

  /* Weather card */
  .weather-card{
    margin-top:6px;
    padding:18px;
    border-radius:14px;
    background: linear-gradient(180deg, rgba(255,255,255,0.04), rgba(255,255,255,0.02));
    display:flex;
    gap:16px;
    align-items:center;
    box-shadow: 0 6px 20px rgba(0,0,0,0.18);
  }

  .weather-emoji{
    font-size:52px;
    line-height:1;
  }

  .weather-info{
    flex:1;
    color:white;
  }
  .weather-info .place{font-weight:700;font-size:18px}
  .weather-info .temp{font-weight:700;font-size:28px;margin-top:6px}
  .weather-stats{margin-top:8px; display:flex; gap:12px; flex-wrap:wrap; color:rgba(255,255,255,0.9); font-size:14px}

  /* Right pane (extra info + chat button) */
  .side {
    display:flex;
    flex-direction:column;
    gap:16px;
    min-width:260px;
  }
  .card-side{
    background:var(--card-bg);
    border-radius:14px;
    padding:14px;
    border:1px solid var(--glass-border);
    box-shadow:var(--shadow);
  }
  .card-side h3{margin:0 0 8px 0;font-size:16px;color:white}

  .meta-row{display:flex;gap:8px;flex-wrap:wrap}

  /* Chat Floating Button (desktop) */
 .chat-fab{
    position:fixed;
    right:20px;
    bottom:20px;
    background:linear-gradient(135deg,#6c5ce7,#00b894);
    color:white;
    border:none;
    padding:14px 16px;
    border-radius:999px;
    box-shadow:0 8px 30px rgba(0,0,0,0.3);
    cursor:pointer;
    display:flex;
    gap:10px;
    align-items:center;
    z-index:999;
  }
  @media (max-width:900px){
    .chat-fab{ right:14px; bottom:14px; padding:12px 14px; }
  }

  /* Chat modal */
  .chat-modal {
  position: fixed;
  right: 20px;
  bottom: 80px;
  width: 360px;
  max-width: 92%;
  height: 520px;
  max-height: 80vh;
  background-color: #394245; /* Solid light blue */
  border-radius: 14px;
  box-shadow: 0 20px 60px rgba(2, 6, 23, 0.45);
  overflow: hidden;
  display: flex;
  flex-direction: column;
  border: 1px solid rgba(255, 255, 255, 0.08);
  z-index: 1000;
  transform-origin: right bottom;
}
  .chat-header{
    padding:12px 14px;
    display:flex;
    align-items:center;
    gap:10px;
    border-bottom:1px solid rgba(255,255,255,0.04);
    background:linear-gradient(90deg, rgba(255,255,255,0.02), transparent);
  }
  .bot-avatar{
    width:40px;height:40px;border-radius:10px;background:linear-gradient(135deg,#6c5ce7,#00b894);display:flex;align-items:center;justify-content:center;font-weight:700;color:white;font-size:18px;
  }
  .chat-header .title{font-weight:700;color:white}
  .chat-header .sub{font-size:12px;color:rgba(255,255,255,0.7)}

  .chat-close{ margin-left:auto;background:transparent;border:none;color:rgba(255,255,255,0.7); cursor:pointer; font-size:18px}

  .chat-body {
    padding: 14px;
    flex: 1;
    overflow: auto;
    display: flex;
    flex-direction: column;
    gap: 12px;
    background-color: #024e68; /* Solid light blue background */
}


  .msg {
    max-width:78%;
    padding:10px 12px;
    border-radius:12px;
    word-break:break-word;
    line-height:1.35;
    font-size:14px;
  }
  .msg.user{
    align-self:flex-end;
    background: linear-gradient(90deg, rgba(255,255,255,0.06), rgba(255,255,255,0.03));
    color:white;
    border-radius:14px 14px 8px 14px;
  }
  .msg.ai{
    align-self:flex-start;
    background: rgba(255,255,255,0.06);
    color:white;
    border-radius:14px 14px 14px 8px;
    display:flex;
    gap:8px;
    align-items:flex-start;
  }
  .ai-avatar{
    width:36px;height:36px;border-radius:8px;background:linear-gradient(135deg,#ff9f43,#ff6b6b);display:flex;align-items:center;justify-content:center;font-weight:700;color:white;font-size:14px;margin-top:2px;
  }

  .typing {
    display:inline-block;
    width:46px;
    text-align:left;
  }
  .dot { height:7px;width:7px;background:white;border-radius:50%;display:inline-block;margin-right:6px;opacity:0.85; animation: blink 1.3s infinite; }
  .dot:nth-child(2){ animation-delay:0.15s }
  .dot:nth-child(3){ animation-delay:0.3s }
  @keyframes blink { 0%{opacity:0.15}50%{opacity:1}100%{opacity:0.15} }

  .chat-input-row{
    display:flex;
    gap:8px;
    padding:10px;
    border-top:1px solid rgba(255,255,255,0.03);
  }
  .chat-input{
    flex:1;
    padding:10px 12px;
    border-radius:10px;
    border:none;
    outline:none;
    background:rgba(255,255,255,0.03);
    color:white;
  }
  .chat-send{
    background:linear-gradient(135deg,#6c5ce7,#00b894);
    color:white;
    border:none;
    padding:8px 12px;
    border-radius:10px;
    cursor:pointer;
    font-weight:700;
  }

  /* small helper */
  .muted { color: rgba(255,255,255,0.8); font-size:13px }
  .center { text-align:center }
  footer.note{ margin-top:12px; font-size:13px; color:rgba(255,255,255,0.6) }

  /* subtle fade in */
  .chat-modal.hidden{ display:none; }
  .chat-modal.open{ animation: pop .18s ease-out; transform:translateY(0) scale(1); }
  @keyframes pop { from { transform:translateY(6px) scale(.98); opacity:0 } to { transform:translateY(0) scale(1); opacity:1 } } 

</style>
</head>
<body>

<div class="app" role="main">

  <!-- LEFT: Weather panel -->
  <div class="panel" aria-labelledby="weather-title">
    <h1 id="weather-title">üå§ Weather & Local Forecast</h1>

    <div class="search-row" role="search">
      <input id="cityInput" type="text" placeholder="Search city (e.g., Mumbai) ‚Äî press Enter or Search" aria-label="City name">
      <button id="searchBtn" type="button" aria-label="Search">Search</button>
    </div>

    <div class="small-row">
      <button class="btn-loc" id="locBtn">üìç My Location</button>
      <div style="margin-left:10px;color:rgba(255,255,255,0.85)">Detected: <span id="detectedName">‚Äî</span></div>
      <button class="btn-chat" id="openChatBtn" title="Open Chat">üí¨ Chat</button>
    </div>

    <div id="weatherCard" class="weather-card" aria-live="polite">
      <div class="weather-emoji" id="wEmoji">üå°Ô∏è</div>
      <div class="weather-info">
        <div class="place" id="placeName">Fetching location...</div>
        <div class="temp" id="tempValue">--¬∞C</div>
        <div class="weather-desc" id="wDesc" style="text-transform:capitalize; margin-top:6px">‚Äî</div>
        <div class="weather-stats" id="wStats">
          <div id="wind">üí® Wind: ‚Äî</div>
          <div id="hum">üíß Humidity: ‚Äî</div>
        </div>
      </div>
    </div>

    <footer class="note">Tip: If the displayed place differs from your town, we show your exact town name from OpenStreetMap while using OpenWeather for weather.</footer>
  </div>

  <!-- RIGHT: Side card -->
  <div class="side">
    <div class="card-side">
      <h3>Quick Info</h3>
      <div class="meta-row">
        <div class="muted">Units: Celsius (¬∞C)</div>
        <div class="muted">Wind: m/s</div>
      </div>
      <p style="margin-top:10px;color:rgba(255,255,255,0.85)">Search any city or tap <strong>My Location</strong> to get weather for your coordinates. Place name is improved using OpenStreetMap reverse geocoding.</p>
    </div>

    <div class="card-side center">
      <h3>Want help?</h3>
      <p class="muted">Tap <strong>Chat</strong> or the floating button to open the assistant.</p>
      <button class="btn-chat" id="openChatBtn2">üí¨ Open Chat</button>
    </div>
  </div>
</div>

<!-- floating chat button -->
<button class="chat-fab" id="fabBtn" aria-label="Open chat">
  <span style="font-size:18px">üí¨</span>
  <div style="text-align:left">
    <div style="font-weight:700">Chat</div>
    <div style="font-size:12px;opacity:0.95">Ask the assistant</div>
  </div>
</button>

<!-- Chat modal (hidden by default) -->
<div class="chat-modal hidden" id="chatModal" role="dialog" aria-modal="true" aria-label="Chatbot">
  <div class="chat-header">
    <div class="bot-avatar">AI</div>
    <div>
      <div class="title">Pocket Assistant</div>
      <div class="sub">I'm a dummy AI ‚Äî try a message üòä</div>
    </div>
    <button class="chat-close" id="closeChatBtn" title="Close chat">‚úï</button>
  </div>

  <div class="chat-body" id="chatBody" aria-live="polite"></div>

  <div class="chat-input-row">
    <input id="chatInput" class="chat-input" placeholder="Type a message and press Enter..." aria-label="Chat message">
    <button id="sendChatBtn" class="chat-send">Send</button>
  </div>
</div>

<script>
/* ========== Configuration ========== */
const API_KEY = "your_api_key"; // <- replace with your OpenWeatherMap API key 
const GEMINI_API_KEY = "your_gemini_api_key"; // <- replace with your Google Gemini API key

/* ========== Utilities ========== */
function el(id){ return document.getElementById(id); }
function setText(id, t){ if (el(id)) el(id).textContent = t; }

function getWeatherEmoji(desc){
  const s = (desc||'').toLowerCase();
  if (s.includes('clear')) return '‚òÄÔ∏è';
  if (s.includes('cloud')) return '‚òÅÔ∏è';
  if (s.includes('rain')) return 'üåßÔ∏è';
  if (s.includes('drizzle')) return 'üå¶Ô∏è';
  if (s.includes('snow')) return '‚ùÑÔ∏è';
  if (s.includes('thunder') || s.includes('storm')) return '‚õàÔ∏è';
  if (s.includes('mist') || s.includes('fog') || s.includes('haze')) return 'üå´Ô∏è';
  return 'üå°Ô∏è';
}

/* ========== Weather display logic ========== */
function displayWeather(locationName, data){
  el('wEmoji').textContent = getWeatherEmoji(data.weather?.[0]?.description || '');
  setText('placeName', locationName || data.name || 'Unknown');
  setText('tempValue', (data.main?.temp != null) ? `${Math.round(data.main.temp)}¬∞C` : '--¬∞C');
  setText('wDesc', data.weather?.[0]?.description || '‚Äî');
  setText('wind', `üí® Wind: ${data.wind?.speed ?? '‚Äî'} m/s`);
  setText('hum', `üíß Humidity: ${data.main?.humidity ?? '‚Äî'}%`);
  el('detectedName').textContent = locationName || data.name || '‚Äî';
}

/* fetch weather by coords */
async function fetchWeather(lat, lon, locationName = null){
  try{
    const url = `https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&appid=${API_KEY}&units=metric`;
    const r = await fetch(url);
    if(!r.ok) throw new Error('Weather fetch failed');
    const data = await r.json();
    displayWeather(locationName, data);
  }catch(err){
    setText('placeName','Unable to fetch weather');
    setText('tempValue','--¬∞C');
    setText('wDesc','‚Äî');
    setText('wind','üí® Wind: ‚Äî');
    setText('hum','üíß Humidity: ‚Äî');
    console.error(err);
  }
}

/* fetch weather by city */
async function fetchCityWeather(city){
  try{
    const url = `https://api.openweathermap.org/data/2.5/weather?q=${encodeURIComponent(city)}&appid=${API_KEY}&units=metric`;
    const r = await fetch(url);
    if(!r.ok) throw new Error('City not found');
    const data = await r.json();
    displayWeather(data.name, data);
  }catch(err){
    setText('placeName','City not found');
    setText('tempValue','--¬∞C');
    setText('wDesc','‚Äî');
    setText('wind','üí® Wind: ‚Äî');
    setText('hum','üíß Humidity: ‚Äî');
    console.error(err);
  }
}

/* Nominatim reverse geocode to get exact place name */
async function getExactLocationName(lat, lon){
  try{
    const url = `https://nominatim.openstreetmap.org/reverse?lat=${lat}&lon=${lon}&format=json&zoom=14&addressdetails=1`;
    const r = await fetch(url);
    if(!r.ok) throw new Error('reverse geocode failed');
    const data = await r.json();
    const addr = data.address || {};
    return addr.village || addr.town || addr.city || addr.hamlet || addr.municipality || (data.display_name ? data.display_name.split(',')[0] : null) || 'Unknown Location';
  }catch(e){
    console.warn(e);
    return 'Unknown Location';
  }
}

/* get current position and show weather */
async function handleMyLocation(){
  setText('placeName','Fetching your location...');
  setText('tempValue','--¬∞C');
  if(!navigator.geolocation){
    setText('placeName','Geolocation not supported');
    return;
  }
  navigator.geolocation.getCurrentPosition(async pos => {
    const lat = pos.coords.latitude;
    const lon = pos.coords.longitude;
    const exact = await getExactLocationName(lat, lon);
    fetchWeather(lat, lon, exact);
  }, err => {
    console.warn(err);
    setText('placeName','Location access denied');
  }, { timeout: 10000 });
}

/* initial load */
handleMyLocation();

/* wire up search */
el('searchBtn').addEventListener('click', ()=>{
  const v = el('cityInput').value.trim();
  if(v) fetchCityWeather(v);
});
el('cityInput').addEventListener('keydown', (e)=>{
  if(e.key === 'Enter') {
    e.preventDefault();
    el('searchBtn').click();
  }
});

/* my location button */
el('locBtn').addEventListener('click', ()=> handleMyLocation());

/* ========== Chat UI logic (updated to use Gemini API) ========== */
const fabBtn = el('fabBtn');
const chatModal = el('chatModal');
const openChatBtn = el('openChatBtn');
const openChatBtn2 = el('openChatBtn2');
const closeChatBtn = el('closeChatBtn');
const chatBody = el('chatBody');
const chatInput = el('chatInput');
const sendChatBtn = el('sendChatBtn');

function openChat(){
  chatModal.classList.remove('hidden');
  chatModal.classList.add('open');
  chatInput.focus();
  if(chatBody.children.length === 0){
    appendAiMessage("Hey! üëã I'm your pocket assistant. Ask me anything about the weather or just chat.");
  }
}
function closeChat(){
  chatModal.classList.add('hidden');
}

fabBtn.addEventListener('click', openChat);
openChatBtn.addEventListener('click', openChat);
openChatBtn2.addEventListener('click', openChat);
closeChatBtn.addEventListener('click', closeChat);

function appendUserMessage(text){
  const m = document.createElement('div');
  m.className = 'msg user';
  m.textContent = text;
  chatBody.appendChild(m);
  chatBody.scrollTop = chatBody.scrollHeight;
}

function appendAiMessage(text){
  const wrapper = document.createElement('div');
  wrapper.className = 'msg ai';
  const avatar = document.createElement('div');
  avatar.className = 'ai-avatar';
  avatar.textContent = 'AI';
  const content = document.createElement('div');
  content.style.maxWidth = 'calc(100% - 44px)';
  content.textContent = text;
  wrapper.appendChild(avatar);
  wrapper.appendChild(content);
  chatBody.appendChild(wrapper);
  chatBody.scrollTop = chatBody.scrollHeight;
}

function showTyping(){
  const wrap = document.createElement('div');
  wrap.className = 'msg ai';
  wrap.id = 'typingIndicator';
  const avatar = document.createElement('div');
  avatar.className = 'ai-avatar';
  avatar.textContent = 'AI';
  const content = document.createElement('div');
  content.className = 'typing';
  content.innerHTML = '<span class="dot"></span><span class="dot"></span><span class="dot"></span>';
  wrap.appendChild(avatar);
  wrap.appendChild(content);
  chatBody.appendChild(wrap);
  chatBody.scrollTop = chatBody.scrollHeight;
}

function hideTyping(){
  const elTp = document.getElementById('typingIndicator');
  if(elTp) elTp.remove();
}

/* Call Gemini API */
async function fetchGeminiReply(userText){
  const url = "https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent";

  const payload = {
    contents: [
      {
        parts: [
          {
            text: userText
          }
        ]
      }
    ]
  };

  try {
    const response = await fetch(url, {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "X-goog-api-key": GEMINI_API_KEY
      },
      body: JSON.stringify(payload)
    });
    if (!response.ok) {
      throw new Error(`API error: ${response.status}`);
    }
    const data = await response.json();
    // Adjust this if the response shape differs
    const aiReply = data.candidates?.[0]?.content || "Sorry, I couldn't generate a response.";
    return aiReply;
  } catch (e) {
    console.error("Gemini API error:", e);
    return "Sorry, I couldn't get a response from AI.";
  }
}

async function sendMessage(){
  const txt = chatInput.value.trim();
  if(!txt) return;
  appendUserMessage(txt);
  chatInput.value = '';

  showTyping();
  const reply = await fetchGeminiReply(txt);
  hideTyping();

  appendAiMessage(reply);
}

sendChatBtn.addEventListener('click', sendMessage);
chatInput.addEventListener('keydown', (e)=>{
  if(e.key === 'Enter' && !e.shiftKey) {
    e.preventDefault();
    sendMessage();
  }
});

document.addEventListener('keydown', (e)=>{
  if(e.key === 'Escape') {
    closeChat();
  }
});

(function restoreScroll(){
  const obs = new MutationObserver(()=> chatBody.scrollTop = chatBody.scrollHeight);
  obs.observe(chatBody,{childList:true, subtree:true});
})();
</script>

</body>
</html>
<!-- End of file: aiweatherapp/weather_with_chat.html -->
<!-- This file contains the complete HTML structure for a weather app with chat functionality. -->




<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weather App</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #6b7280, #1e3a8a);
            color: #fff;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
        }
        .weather-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            width: 100%;
            max-width: 400px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            text-align: center;
        }
        .weather-card h1 {
            font-size: 1.8rem;
            margin: 0 0 10px;
        }
        .weather-card .emoji {
            font-size: 4rem;
            margin: 10px 0;
        }
        .weather-card .temp {
            font-size: 2.5rem;
            font-weight: bold;
            margin: 10px 0;
        }
        .weather-card .description {
            font-size: 1.2rem;
            text-transform: capitalize;
            margin: 5px 0;
        }
        .weather-card .details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 20px;
        }
        .weather-card .details div {
            background: rgba(255, 255, 255, 0.15);
            padding: 10px;
            border-radius: 10px;
        }
        .error {
            color: #ff6b6b;
            font-size: 1rem;
            margin-top: 10px;
        }
        .loading {
            font-size: 1rem;
            margin-top: 10px;
        }
        @media (max-width: 600px) {
            .weather-card {
                padding: 15px;
            }
            .weather-card h1 {
                font-size: 1.5rem;
            }
            .weather-card .temp {
                font-size: 2rem;
            }
            .weather-card .emoji {
                font-size: 3rem;
            }
            .weather-card .details {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="weather-card">
        <h1 id="location">Getting location...</h1>
        <div id="emoji" class="emoji">‚è≥</div>
        <div id="temp" class="temp"></div>
        <div id="description" class="description"></div>
        <div class="details">
            <div>Humidity: <span id="humidity"></span></div>
            <div>Wind: <span id="wind"></span></div>
            <div>Pressure: <span id="pressure"></span></div>
            <div>Feels Like: <span id="feels-like"></span></div>
        </div>
        <div id="error" class="error"></div>
        <div id="loading" class="loading"></div>
    </div>

    <script>
        const apiKey = '4354340dce41b8d36d2f376618eedbfa'; // Replace with your OpenWeatherMap API key
        const weatherEmojis = {
            'Clear': '‚òÄÔ∏è',
            'Clouds': '‚òÅÔ∏è',
            'Rain': 'üåßÔ∏è',
            'Drizzle': 'üå¶Ô∏è',
            'Thunderstorm': '‚õàÔ∏è',
            'Snow': '‚ùÑÔ∏è',
            'Mist': 'üå´Ô∏è',
            'Fog': 'üå´Ô∏è',
            'Haze': 'üå´Ô∏è'
        };

        function showLoading(message) {
            document.getElementById('loading').textContent = message;
            document.getElementById('error').textContent = '';
        }

        function showError(message) {
            document.getElementById('error').textContent = message;
            document.getElementById('loading').textContent = '';
        }

        function displayWeather(data) {
            document.getElementById('location').textContent = `${data.name}, ${data.sys.country}`;
            document.getElementById('temp').textContent = `${Math.round(data.main.temp)}¬∞C`;
            const weatherMain = data.weather[0].main;
            document.getElementById('emoji').textContent = weatherEmojis[weatherMain] || 'üåç';
            document.getElementById('description').textContent = data.weather[0].description;
            document.getElementById('humidity').textContent = `${data.main.humidity}%`;
            document.getElementById('wind').textContent = `${data.wind.speed} m/s`;
            document.getElementById('pressure').textContent = `${data.main.pressure} hPa`;
            document.getElementById('feels-like').textContent = `${Math.round(data.main.feels_like)}¬∞C`;
            document.getElementById('loading').textContent = '';
        }

        function getWeatherByLocation(lat, lon) {
            showLoading('Fetching weather data...');
            const url = `https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&units=metric&appid=${apiKey}`;
            console.log('Fetching URL:', url.replace(apiKey, '****')); // Hide key in logs
            fetch(url)
                .then(response => {
                    if (!response.ok) {
                        return response.json().then(err => {
                            throw new Error(`API Error: ${err.message} (Status: ${response.status})`);
                        });
                    }
                    return response.json();
                })
                .then(data => {
                    console.log('API Response:', data);
                    displayWeather(data);
                })
                .catch(error => {
                    console.error('Fetch Error:', error);
                    showError(`Error fetching weather data: ${error.message}. Please check your API key or try again.`);
                });
        }

        function getLocation() {
            showLoading('Getting your location...');
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    position => {
                        const { latitude, longitude } = position.coords;
                        console.log('Geolocation Success:', { latitude, longitude });
                        getWeatherByLocation(latitude, longitude);
                    },
                    error => {
                        console.error('Geolocation Error:', error.message, error.code);
                        showError('Unable to get location. Falling back to London.');
                        getWeatherByLocation(51.5074, -0.1278); // Fallback to London
                    }
                );
            } else {
                showError('Geolocation not supported. Falling back to London.');
                getWeatherByLocation(51.5074, -0.1278); // Fallback to London
            }
        }

        window.onload = getLocation;
    </script>
</body>
</html>